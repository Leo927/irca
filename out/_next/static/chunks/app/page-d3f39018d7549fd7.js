(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{4960:function(){},6759:function(){},6272:function(){},9431:function(t,e,n){Promise.resolve().then(n.bind(n,9385))},9385:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return X}});var r=n(7437),s=n(2265);class a{copy(){return new a(this.x,this.y)}add(t){return new a(this.x+t.x,this.y+t.y)}subtract(t){return new a(this.x-t.x,this.y-t.y)}multiply(t){return new a(this.x*t,this.y*t)}divide(t){return new a(this.x/t,this.y/t)}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){let t=this.magnitude();return new a(this.x/t,this.y/t)}toString(){return"(".concat(this.x,", ").concat(this.y,")")}loadFromJson(t){return new a(t.x,t.y)}toJson(){return{x:this.x,y:this.y}}static fromJson(t){return new a(t.x,t.y)}constructor(t,e){this.x=t,this.y=e}}class o{getStartVector2(){return this.startVector2}setStartVector2(t){this.startVector2=t}getEndVector2(){return this.endVector2}setEndVector2(t){this.endVector2=t}getLength(){let t=this.endVector2.x-this.startVector2.x,e=this.endVector2.y-this.startVector2.y;return Math.sqrt(t*t+e*e)}get start(){return this.startVector2}get end(){return this.endVector2}toString(){return"[".concat(this.startVector2,", ").concat(this.endVector2,"]")}static line_intersect(t,e){let n=t.startVector2.x,r=t.startVector2.y,s=t.endVector2.x,o=t.endVector2.y,l=e.startVector2.x,c=e.startVector2.y,d=e.endVector2.x,h=e.endVector2.y;if(n===s&&r===o||l===d&&c===h)throw new i;let g=(h-c)*(s-n)-(d-l)*(o-r);if(0===g)throw new i;let u=((d-l)*(r-c)-(h-c)*(n-l))/g,y=n+u*(s-n),p=r+u*(o-r);if(Number.isNaN(y)||Number.isNaN(p))throw new i;return new a(y,p)}constructor(t,e){this.startVector2=t,this.endVector2=e}}class i extends Error{constructor(){super("Edges are parallel or coincident")}}class l{get area(){let t=0,e=this.vertices.length;for(let n=0;n<e;n++){let r=this.vertices[n],s=this.vertices[(n+1)%e];t+=r.x*s.y-s.x*r.y}return Math.abs(t/2)}get lines(){let t=this.vertices.length,e=[];for(let n=0;n<t;n++){let r=this.vertices[n],s=this.vertices[(n+1)%t];e.push(new o(r,s))}return e}get edges(){return this.lines}constructor(t){this.vertices=t}}class c{calculateSecondVertex(){if(null===this.vertices[0])throw Error("First vertex does not exist");let t=this.vertices[0],e=new a(t.x+this.data.edgeLengths[0]*Math.cos(this.data.edge0Angle),t.y+this.data.edgeLengths[0]*Math.sin(this.data.edge0Angle));this.vertices[1]=e}calculateForthVertex(){if(null===this.vertices[0])throw Error("First vertex does not exist");let t=this.vertices[0],e=new a(t.x+this.data.edgeLengths[3]*Math.cos(g(this.data.angleBetweenFirstAndLastEdge)),t.y-this.data.edgeLengths[3]*Math.sin(g(this.data.angleBetweenFirstAndLastEdge)));this.vertices[3]=e}calculateThirdVertex(){if(null===this.vertices[1]||null===this.vertices[3])throw new d;let t=this.vertices[1],e=this.vertices[3],[n,r]=this.findCirclesIntersection(t,this.data.edgeLengths[1],e,this.data.edgeLengths[2]),s=n.y<r.y?n:r;this.vertices[2]=s}findCirclesIntersection(t,e,n,r){let s=t.x-n.x,o=t.y-n.y,i=Math.sqrt(o*o+s*s),l=(e*e-r*r+i*i)/(2*i),c=Math.sqrt(e*e-l*l),d=t.x+l*(n.x-t.x)/i,h=t.y+l*(n.y-t.y)/i,g=d+c*(n.y-t.y)/i,u=h-c*(n.x-t.x)/i,y=d-c*(n.y-t.y)/i,p=h+c*(n.x-t.x)/i;return[new a(g,u),new a(y,p)]}constructPolygon(){if(this.calculateSecondVertex(),this.calculateForthVertex(),this.calculateThirdVertex(),null===this.vertices[0]||null===this.vertices[1]||null===this.vertices[2]||null===this.vertices[3])throw Error("One or more vertices are missing");return new l([this.vertices[0],this.vertices[1],this.vertices[2],this.vertices[3]])}constructor(t){this.data=new h,this.vertices=[null,null,null,null],this.data=t,this.vertices[0]=t.firstVertex}}class d extends Error{constructor(){super("Circles do not intersect")}}class h{static fromJSON(t){let e=new h;return e.edgeLengths=t.edgeLengths,e.edge0Angle=t.edge0Angle,e.angleBetweenFirstAndLastEdge=t.angleBetweenFirstAndLastEdge,e.firstVertex=a.fromJson(t.firstVertex),e}withAngleBetweenFirstAndLastEdgeInDegree(t){let e=this.copy();return e.angleBetweenFirstAndLastEdge=t,e}copy(){let t=new h;return t.edgeLengths=this.edgeLengths,t.edge0Angle=this.edge0Angle,t.angleBetweenFirstAndLastEdge=this.angleBetweenFirstAndLastEdge,t.firstVertex=this.firstVertex,t}constructor(){this.edgeLengths=[0,0,0,0],this.edge0Angle=0,this.angleBetweenFirstAndLastEdge=0,this.firstVertex=new a(0,0)}}function g(t){return t*Math.PI/180}var u=n(6548),y=n(2118),p=n(6858);function x(){return(0,r.jsx)(p.Z,{id:"outlined-basic",label:"Outlined",variant:"outlined"})}var f=n(1326),w=n(8433);let v=(0,s.createContext)([]),m=(0,s.createContext)(void 0);function C(t){console.debug("Saving polygon datas",t),localStorage.setItem("polygonDatas",JSON.stringify(t))}function b(t,e){switch(e.type){case"add":if(void 0===e.payload||null===e.payload||!(e.payload instanceof S||e.payload instanceof h))throw new N("Invalid payload: ".concat(JSON.stringify(e.payload)));console.log("Adding polygon data: ".concat(JSON.stringify(e.payload)));var n=[...t,S.fromJSON(e.payload).withIndex(t.length)];return C(n),n;case"remove":return console.log("Removing polygon data: ".concat(JSON.stringify(e.payload))),C(n=t.filter(t=>t.index!==e.payload.index)),n;case"update":return console.log("Updating polygon data: ".concat(JSON.stringify(e.payload))),C(n=t.map((t,n)=>n===e.payload.index?e.payload:t)),n;case"clear":return console.log("Clearing polygon data"),C([]),[];case"set":return console.log("Setting polygon data: ".concat(JSON.stringify(e.payload))),C(e.payload),e.payload;case"show":return console.log("Showing polygon data: ".concat(JSON.stringify(e.payload))),C(n=t.map((t,n)=>n===e.payload.index?t.withShow(!0):t)),n;case"hide":return console.log("Hiding polygon data: ".concat(JSON.stringify(e.payload))),C(n=t.map((t,n)=>n===e.payload.index?t.withShow(!1):t)),n;default:throw Error("Invalid action type")}}class S extends h{static fromJSON(t){if(null==t)throw new N("Invalid payload: ".concat(JSON.stringify(t)));let e=new S;return e.edgeLengths=t.edgeLengths,e.edge0Angle=t.edge0Angle,e.angleBetweenFirstAndLastEdge=t.angleBetweenFirstAndLastEdge,e.firstVertex=new a(t.firstVertex.x,t.firstVertex.y),e.index=t.index,e.show=t.show,e.color=t.color,e}withShow(t){var e=S.fromJSON(this);return e.show=t,e}withIndex(t){var e=S.fromJSON(this);return e.index=t,e}withColor(t){var e=S.fromJSON(this);return e.color=t,e}constructor(){super(),this.index=0,this.show=!1,this.color="black"}}class N extends Error{constructor(t){super(t||"Payload value is invalid")}}var j=n(8549),E=n(437);function V(t){let e=(0,s.useContext)(m),[n,a]=(0,s.useState)(!1),[o,i]=(0,s.useState)("");return(0,r.jsx)(j.Z,{error:n,variant:"standard",style:{display:"flex",flexDirection:"row"},children:(0,r.jsxs)(w.ZP,{container:!0,spacing:1,children:[t.data.edgeLengths.map((e,n)=>(0,r.jsx)(w.ZP,{item:!0,xs:3,children:(0,r.jsx)(p.Z,{type:"number",label:"".concat(function(t){switch(t){case 0:return"下连杆(mm)";case 1:return"后连杆(mm)";case 2:return"上连杆(mm)";case 3:return"前连杆(mm)";default:return""}}(n)),value:e,onChange:e=>{t.setData(t=>{console.debug("updating edgeLengths");let r=t.edgeLengths.map((t,r)=>r===n?parseInt(e.target.value):t),s=h.fromJSON(t);return s.edgeLengths=r,s})}})},n)),(0,r.jsx)(w.ZP,{item:!0,xs:6,children:(0,r.jsx)(p.Z,{className:"w-full",type:"number",label:"下连杆与前连杆初始角度",value:t.data.angleBetweenFirstAndLastEdge,onChange:e=>t.setData(t=>{console.debug("updating angleBetweenFirstAndLastEdge");let n=h.fromJSON(t);return n.angleBetweenFirstAndLastEdge=parseInt(e.target.value),n})})}),(0,r.jsx)(w.ZP,{item:!0,xs:6,children:(0,r.jsx)(u.Z,{className:"w-full",onClick:()=>{!function(){let n=t.data;e({type:"add",payload:n}),console.log("save button clicked, data: ".concat(JSON.stringify(n)))}()},children:"保存"})}),(0,r.jsx)(E.Z,{children:o})]})})}var D=n(7382);class L{getRotationalCenter(){let t=this.polygon.lines[1],e=this.polygon.lines[3];return o.line_intersect(t,e)}constructor(t){this.polygon=t}}class P{findRotationalCenters(){let t=[];for(let e=0;e<360;e+=this.INTERVAL){let n=new c(this.data.withAngleBetweenFirstAndLastEdgeInDegree(e)).constructPolygon();try{let e=new L(n).getRotationalCenter();t.push(e)}catch(t){if(t instanceof i)continue;throw t}}return t}constructor(t){this.INTERVAL=1,this.data=t}}class Z{drawPolygon(){if(this.polygon.vertices.length<4){console.error("Polygon must have 4 vertices");return}this.group=new D.fabric.Group([],{hasControls:!1,hoverCursor:"pointer",selectable:!1}),this.drawPolygonShape(),this.drawRotationalCenters(),this.drawCurrentRotationalCenter(),this.canvas.add(this.group)}drawPolygonShape(){var t=new D.fabric.Polyline([...this.polygon.vertices,this.polygon.vertices[0]],{stroke:this.constructionData.color,fill:"",strokeWidth:2,selectable:!0,hasControls:!1,hasBorders:!0,hoverCursor:"pointer"});this.group.addWithUpdate(t)}drawCurrentRotationalCenter(){if(4===this.polygon.vertices.length)try{let t=new L(this.polygon).getRotationalCenter(),e=new D.fabric.Circle({stroke:this.constructionData.color,radius:5,fill:"",left:t.x,top:t.y,hasControls:!1,hoverCursor:"pointer"});this.group.addWithUpdate(e)}catch(t){console.error("Error",t)}}drawRotationalCenters(){if(4===this.polygon.vertices.length){let t=new P(this.constructionData).findRotationalCenters(),e=new D.fabric.Polyline(t,{transparentCorners:!0,stroke:this.constructionData.color,fill:"",selectable:!0,hasControls:!1,hasBorders:!0,hoverCursor:"pointer"});this.group.addWithUpdate(e)}}constructor(t,e){if(e instanceof S==!1)throw Error("Invalid construction data");this.canvas=t,this.constructionData=e,this.polygon=new c(e).constructPolygon(),this.group=new D.fabric.Group}}function O(t){let e=(0,s.useRef)(null),[n,a]=(0,s.useState)(null);return(0,s.useEffect)(()=>{let t=new D.fabric.Canvas(e.current,{height:400,width:800});return D.fabric.Object.prototype.transparentCorners=!0,t.relativePan(new D.fabric.Point(200,200)),a(t),()=>{t.dispose()}},[]),(0,s.useEffect)(()=>{null!==n&&(n.clear(),t.polygonDatas.forEach(t=>{new Z(n,t).drawPolygon()}))},[n,t.polygonDatas]),(0,r.jsx)("canvas",{className:"self-center h-full",id:"myCanvas",width:"100%",height:400,ref:e})}var A=n(270),J=n(9285),F=n(888),I=n(4696),k=n(2879),B=n(8564),R=n(2168),M=n(5870),_=n(6065);class W{getHandsOffDistance(){return new H(new P(this.polygon1).findRotationalCenters(),new P(this.polygon2).findRotationalCenters()).getSimilarity()}constructor(t,e){this.polygon1=t,this.polygon2=e}}class q{getSimilarity(){throw Error("Not implemented")}constructor(t,e){this.pointCloud1=t,this.pointCloud2=e}}class H extends q{getSimilarity(){this.pointCloud1,this.pointCloud2;let t=0;return this.pointCloud1.forEach((e,n)=>{let r=1/0;this.pointCloud2.forEach(t=>{let n=new o(e,t).getLength();n<r&&(r=n)}),t+=r}),t}}var T=n(7630),U=n(335);let G=[{name:"黑色",value:"black"},{name:"红色",value:"red"},{name:"绿色",value:"green"},{name:"蓝色",value:"blue"},{name:"黄色",value:"yellow"}];function z(t){let e=(0,s.useContext)(m);return(0,r.jsxs)(A.Z,{className:"bg-gray-300",children:[(0,r.jsx)(J.Z,{title:"Polygon ".concat(t.polygonData.index),action:(0,r.jsx)(F.Z,{title:"删除该记录",placement:"top",children:(0,r.jsx)(U.Z,{onClick:()=>e({type:"remove",payload:t.polygonData}),children:(0,r.jsx)(T.Z,{})})})}),(0,r.jsxs)(I.Z,{children:["HandsOffDistance ",new W(t.currentPolygonData,t.polygonData).getHandsOffDistance().toFixed(2)]}),(0,r.jsxs)(k.Z,{children:[(0,r.jsx)(F.Z,{title:"加载这组数据到编辑器中",placement:"top",children:(0,r.jsx)(u.Z,{className:"bg-gray-100",sx:{boxShadow:3},onClick:()=>{t.setCurrentPolygonData(t.polygonData)},children:"使用"})}),(0,r.jsxs)(j.Z,{children:[(0,r.jsx)(_.Z,{id:"demo-simple-select-autowidth-label",children:"颜色"}),(0,r.jsx)(R.Z,{labelId:"demo-simple-select-autowidth-label",id:"demo-simple-select-autowidth",value:t.polygonData.color,onChange:n=>{t.polygonData.color=n.target.value,e({type:"update",payload:t.polygonData})},autoWidth:!0,label:"颜色",children:G.map((t,e)=>(0,r.jsx)(M.Z,{value:t.value,children:t.name},e))})]}),(0,r.jsx)(F.Z,{title:"显示/隐藏",placement:"top",children:(0,r.jsx)(B.Z,{onChange:n=>{n.target.checked?e({type:"show",payload:t.polygonData}):e({type:"hide",payload:t.polygonData})},checked:t.polygonData.show})})]})]},t.polygonData.index)}function K(t){let e=(0,s.useContext)(v);return(0,s.useContext)(m),(0,r.jsx)(w.ZP,{container:!0,spacing:2,children:e.map((e,n)=>(0,r.jsx)(w.ZP,{item:!0,xs:6,children:(0,r.jsx)(z,{polygonData:e,currentPolygonData:t.currentPolygonData,setCurrentPolygonData:t.setCurrentPolygonData})},n))})}function Q(){return JSON.parse(window.localStorage.getItem("polygonDatas")||"[]").map(S.fromJSON)}function X(){let[t,e]=(0,s.useState)(new h),[n,o]=(0,s.useState)(!1),[i,l]=(0,s.useReducer)(b,[]),[c,d]=(0,s.useState)([]);return(0,s.useEffect)(()=>{let e=S.fromJSON(t).withShow(!0).withIndex(-1);console.debug("updating drawing datas",e,t),d([...i.filter(t=>t.show),e.withColor("black")])},[i,t]),(0,s.useEffect)(()=>{Q().forEach(t=>l({type:"add",payload:t}))},[]),(0,s.useEffect)(()=>{l({type:"load",payload:Q()}),e(function(){var t;let e=null===(t=window)||void 0===t?void 0:t.localStorage.getItem("polygonData");if(null==e){let t=new h;return t.edgeLengths=[60,100,120,100],t.edge0Angle=0,t.angleBetweenFirstAndLastEdge=80,t.firstVertex=new a(0,0),t}try{return h.fromJSON(JSON.parse(e))}catch(t){return new h}}())},[]),(0,s.useEffect)(()=>{localStorage.setItem("polygonData",JSON.stringify(t))},[t]),(0,r.jsx)(v.Provider,{value:i,children:(0,r.jsx)(m.Provider,{value:l,children:(0,r.jsxs)("main",{className:"w-full bg-gray-300 items-center mx-auto columns-1 p-6",children:[(0,r.jsx)(f.Z,{className:"items-end py-2",children:(0,r.jsx)(u.Z,{className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",onClick:()=>o(!0),children:"设置"})}),(0,r.jsxs)(w.ZP,{container:!0,children:[(0,r.jsxs)(w.ZP,{item:!0,xs:6,className:"bg-gray-200",padding:"normal",children:[(0,r.jsx)(O,{polygonDatas:c}),(0,r.jsx)(V,{data:t,setData:e})]}),(0,r.jsx)(w.ZP,{item:!0,xs:6,className:"bg-gray-200",children:(0,r.jsx)(K,{currentPolygonData:t,setCurrentPolygonData:e})})]}),(0,r.jsx)(y.Z,{open:n,onClose:()=>o(!1),"aria-labelledby":"设置","aria-describedby":"设置",children:(0,r.jsx)(f.Z,{children:(0,r.jsx)(x,{})})})]})})})}}},function(t){t.O(0,[789,858,702,971,23,744],function(){return t(t.s=9431)}),_N_E=t.O()}]);